<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title from markattendence.html -->
    <title>Attendance Portal</title>
    
    <!-- Links from index.html -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <!-- Scripts from markattendence.html -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script>
        // Tailwind config from markattendence.html
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'portal-blue': '#4A72FF',
                        'portal-gray': '#F7F8FA',
                        'present': '#34D399',
                        'absent': '#F87171',
                        'late': '#FBBF24',
                    }
                }
            }
        }
    </script>

    <style>
        /* --- STYLES FROM index.html --- */
        :root {
            --font-main: 'Inter', sans-serif; --transition-speed: 0.3s; --page-transition-duration: 0.4s; --bg-main: #F8F9FA;
            --bg-content: #FFFFFF; --border-color: #E9ECEF; --text-primary: #1F2937; --text-secondary: #6C757D;
            --menu-title-color: #ADB5BD; --accent-primary: #5D50E6; --accent-primary-hover: #4338CA;
            --accent-primary-light: #E9E7FD; --notification-bg-color: #FA3E3E; --shadow-color-light: rgba(0, 0, 0, 0.05);
            --danger-color: #EF4444;
        }
        [data-theme="dark"] {
            --bg-main: #121212; --bg-content: #1E1E1E; --border-color: #333333; --text-primary: #E0E0E0;
            --text-secondary: #A0A0A0; --menu-title-color: #7A7A7A; --accent-primary: #8A7FFF;
            --accent-primary-hover: #6366F1; --accent-primary-light: #2A2A44; --notification-bg-color: #FA3E3E;
            --shadow-color-light: rgba(0, 0, 0, 0.2); --danger-color: #F87171;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-10px); } }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-main); color: var(--text-primary); background-color: var(--bg-main); overflow: hidden; height: 100vh; width: 100vw; transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease; }
        .app-container { display: flex; height: 100vh; }
        .sidebar { width: 260px; min-width: 260px; padding: 20px 15px; display: flex; flex-direction: column; background-color: var(--bg-content); border-right: 1px solid var(--border-color); transition: all var(--transition-speed) ease; }
        .sidebar-header { position: relative; }
        .user-switch-wrapper { display: flex; align-items: center; gap: 15px; padding-bottom: 20px; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); cursor: pointer; }
        .user-switch-wrapper .logo-icon { color: var(--accent-primary); width: 32px; height: 32px; flex-shrink: 0; }
        .user-switch-wrapper .logo-details { display: flex; flex-direction: column; flex-grow: 1; }
        .user-switch-wrapper .logo-name { font-size: 16px; font-weight: 600; color: var(--text-primary); }
        .user-switch-wrapper .logo-subtext { font-size: 12px; color: var(--text-secondary); }
        .user-switch-arrow { color: var(--text-secondary); transition: transform var(--transition-speed) ease; }
        .user-switch-arrow.active { transform: rotate(180deg); }
        .user-switcher-menu { position: absolute; top: 75px; left: 0; width: 100%; background-color: var(--bg-content); border: 1px solid var(--border-color); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 8px; z-index: 10; opacity: 0; visibility: hidden; transform: translateY(10px) scale(0.95); transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease, visibility var(--transition-speed) ease; }
        .user-switcher-menu.active { opacity: 1; visibility: visible; transform: translateY(0) scale(1); }
        .user-switcher-menu .switcher-item { display: flex; align-items: center; gap: 12px; padding: 10px; border-radius: 6px; cursor: pointer; transition: background-color var(--transition-speed) ease; }
        .user-switcher-menu .switcher-item:hover { background-color: var(--accent-primary-light); }
        .user-switcher-menu .switcher-item i { color: var(--text-secondary); width: 20px; text-align: center; }
        .user-switcher-menu .switcher-item span { font-size: 14px; font-weight: 500; color: var(--text-primary); }
        .sidebar-menu { flex-grow: 1; overflow-y: auto; }
        .menu-section { margin-bottom: 25px; }
        .menu-title { display: block; margin-bottom: 10px; padding: 0 10px; font-size: 12px; font-weight: 500; color: var(--menu-title-color); text-transform: uppercase; letter-spacing: 0.5px; transition: opacity 0.2s ease; }
        .nav-links { list-style: none; }
        .nav-links li a { display: flex; align-items: center; padding: 12px 10px; margin-bottom: 5px; border-radius: 8px; text-decoration: none; color: var(--text-primary); font-size: 14px; font-weight: 500; transition: all var(--transition-speed) ease; position: relative; }
        .nav-links li a i { font-size: 18px; margin-right: 15px; width: 20px; text-align: center; color: var(--text-secondary); transition: color var(--transition-speed) ease, margin-right var(--transition-speed) ease; }
        .nav-links li a > span { transition: opacity 0.2s ease, visibility 0.2s ease, width 0.2s ease; }
        .nav-links li:not(.active) a:hover { background-color: var(--accent-primary-light); color: var(--accent-primary); }
        .nav-links li:not(.active) a:hover i { color: var(--accent-primary); }
        .nav-links li.active > a:not(.dropdown-toggle) { background-color: var(--accent-primary-light); color: var(--accent-primary); font-weight: 600; }
        .nav-links li.active > a:not(.dropdown-toggle) i { color: var(--accent-primary); }
        .nav-links li.active > a:not(.dropdown-toggle)::before { content: ''; position: absolute; left: -15px; top: 50%; transform: translateY(-50%); height: 70%; width: 4px; background-color: var(--accent-primary); border-radius: 0 4px 4px 0; transition: all var(--transition-speed) ease; }
        .nav-links li.has-submenu .dropdown-toggle { justify-content: space-between; width: 100%; cursor: pointer; }
        .nav-links li.has-submenu .dropdown-toggle span { display: flex; align-items: center; }
        .dropdown-arrow { font-size: 12px; transition: transform var(--transition-speed) ease, opacity 0.2s ease; color: var(--text-secondary); }
        .nav-links li.has-submenu.active > .dropdown-toggle .dropdown-arrow { transform: rotate(180deg); }
        .submenu { list-style: none; padding-left: 25px; max-height: 0; overflow: hidden; transition: max-height 0.4s ease-in-out; }
        .nav-links li.has-submenu.active .submenu { max-height: 500px; margin-top: 5px; }
        .submenu li a { display: flex; align-items: center; padding: 8px 10px; font-size: 13px; color: var(--text-secondary); }
        .submenu li a:hover { color: var(--accent-primary); background-color: transparent; }
        .submenu li a img { width: 24px; height: 24px; border-radius: 50%; margin-right: 12px; object-fit: cover; }
        .submenu li a .notification-badge { margin-left: auto; background-color: var(--accent-primary); color: #fff; font-size: 10px; font-weight: 600; min-width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; padding: 0 4px; }
        .sidebar-footer .user-profile { display: flex; align-items: center; gap: 15px; }
        .sidebar-footer .user-profile img { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        .sidebar-footer .user-profile .user-details { display: flex; flex-direction: column; }
        .sidebar-footer .user-profile .user-name { font-size: 14px; font-weight: 600; color: var(--text-primary); }
        .sidebar-footer .user-profile .user-email { font-size: 12px; color: var(--text-secondary); }
        .theme-switcher-container { display: flex; align-items: center; justify-content: space-between; padding: 12px 10px; margin-bottom: 20px; }
        .theme-switcher-container span { font-size: 14px; font-weight: 500; color: var(--text-primary); }
        .theme-switch { cursor: pointer; background-color: var(--accent-primary-light); width: 50px; height: 26px; border-radius: 50px; position: relative; display: flex; align-items: center; padding: 0 5px; }
        .switch-thumb { background-color: #fff; width: 18px; height: 18px; border-radius: 50%; position: absolute; left: 4px; transition: transform var(--transition-speed) ease; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        .theme-switch i { font-size: 12px; color: var(--accent-primary); }
        .theme-switch .fa-sun { margin-left: auto; }
        [data-theme="dark"] .switch-thumb { transform: translateX(24px); background-color: var(--bg-content); }
        .main-content { flex-grow: 1; display: flex; flex-direction: column; overflow-y: auto; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 1.5rem 2.5rem; position: sticky; top: 0; z-index: 100; background-color: var(--bg-main); border-bottom: 1px solid var(--border-color); min-height: 90px; }
        .header-actions { display: flex; align-items: center; gap: 1.5rem; }
        .profile { display: flex; align-items: center; gap: 12px; }
        .profile img { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid var(--border-color); }
        .profile span { font-weight: 600; font-size: 0.95rem; }
        .search { background: var(--bg-content); position: relative; display: flex; border-radius: 8px; box-shadow: 0 4px 16px -1px var(--shadow-color-light); width: 62px; height: 62px; padding: 0; transition: width 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55), background .1s ease, transform .1s ease; }
        .search .bar { position: absolute; left: 15px; top: 15px; width: 32px; height: 32px; overflow: hidden; cursor: pointer; z-index: 2; }
        .search form { opacity: 0; pointer-events: none; transition: opacity 0.3s ease; position: relative; height: 100%;}
        .search.open { width: 350px; }
        .search.open .bar { left: 16px; top: 15px; cursor: default; }
        .search.open form { opacity: 1; pointer-events: auto; }
        .search .bar span { display: block; color: #fff; position: absolute; left: 12px; top: 0; line-height: 32px; font-weight: 500; font-size: 16px; opacity: 0; right: 16px; overflow: hidden; white-space: nowrap; }
        .search .bar:before { content: ''; position: absolute; display: block; left: 0; top: 0; bottom: 0; right: 16px; border-radius: 16px 0 0 16px; background: var(--accent-primary); opacity: 0; }
        .search .bar .icon { flex: 0 0 32px; width: 32px; height: 32px; background: var(--accent-primary); border-radius: 50%; position: absolute; z-index: 1; top: 0; right: 0; transform-style: preserve-3d; transform-origin: 0 0; transform: scale(.8); transition: transform .4s ease 0s, background .1s ease, opacity 0.3s ease; }
        .search .bar .icon:before, .search .bar .icon:after { content: ''; display: block; position: absolute; backface-visibility: hidden; border-radius: 50%; }
        .search .bar .icon:before { background: #fff; left: 4px; top: 4px; right: 4px; bottom: 4px; z-index: 2; transform: rotateY(0deg); transition: background .1s ease; }
        .search .bar .icon:after { background: var(--accent-primary); left: 0; top: 0; right: 0; bottom: 0; transform: rotateY(180deg); transition: background .1s ease; }
        .search .bar .icon i { left: 75%; top: 84%; position: absolute; display: block; transform: rotate(-45deg); transform-origin: 0 0; }
        .search .bar .icon i:before { content: ''; width: 4px; height: 16px; border-radius: 2px; background: var(--accent-primary); display: block; transform-origin: 50% 0; transition: transform .4s ease 0s, background .1s ease; }
        .search form input { height: 100%; width: 0; padding: 0 0 0 48px; color: var(--text-primary); caret-color: var(--accent-primary); border: 0; background: 0; outline: none; font-size: 16px; font-family: inherit; font-weight: 500; transition: width 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55), color .1s ease; }
        .search.open form input { width: 100%; padding-right: 16px; }
        .search form input::placeholder { color: var(--text-secondary); opacity: 1; }
        .search form span { position: absolute; visibility: hidden; top: -9999px; left: -9999px; white-space: pre; font-size: 16px; font-family: inherit; font-weight: 500; }
        .search .close { border-radius: 50%; position: absolute; right: 16px; width: 32px; height: 32px; top: 15px; background: var(--accent-primary-light); cursor: pointer; opacity: 0; visibility: hidden; transform: translate(-8px, 0); transition: transform .3s ease 0s, opacity .3s ease 0s, visibility .3s ease 0s; }
        .search .close:before, .search .close:after { content: ''; position: absolute; width: 2px; border-radius: 1px; height: 14px; background: var(--text-secondary); display: block; left: 50%; top: 50%; transition: background .3s ease; }
        .search .close:before { transform: translate(-50%, -50%) rotate(45deg); }
        .search .close:after { transform: translate(-50%, -50%) rotate(-45deg); }
        .search ul { background: var(--bg-content); border-radius: 8px; overflow: hidden; margin: 0; padding: 8px 0 24px 0; list-style: none; position: absolute; left: 16px; top: 62px; white-space: nowrap; transition: opacity 0.3s ease; visibility: hidden; opacity: 0; }
        .search ul.show { visibility: visible; opacity: 1; }
        .search ul.show li { opacity: 1; visibility: visible; transform: translate(0, 0); }
        .search ul li { margin: 0 0 20px 0; opacity: 0; visibility: hidden; transition: all .3s ease; transform: translate(0, -6px); }
        .search ul li a { display: block; font-size: 12px; text-decoration: none; padding-left: 36px; padding-right: 24px; position: relative; }
        .search ul li a h5 { margin: 0; color: var(--text-primary); font-size: 12px; }
        .search ul li a p { margin: 4px 0; color: var(--text-secondary); }
        .search.submit { background: var(--accent-primary); transform: scale(.92); }
        .search.submit .bar .icon { background: #fff; }
        .search.submit .bar .icon:before { background: var(--accent-primary); }
        .search.submit .bar .icon:after { background: #fff; }
        .search.submit .bar .icon i:before { background: #fff; }
        .search.submit form input { color: #fff; caret-color: #fff; }
        .search.prepare .bar:before { opacity: 1; transition: opacity 0s ease 1.25s; }
        .search.prepare .bar .icon { transform: scale(1); transform-origin: 50% 50% 0; transition: transform .4s ease .85s, transform-origin 0s ease 1.25s, background .1s ease; }
        .search.prepare .bar .icon i:before { transform: scaleY(0); transition: transform .4s ease .4s, background .1s ease; }
        .search.animate .bar .icon { transform: rotateY(75deg); transition: transform .6s ease 0s; }
        .search.animate .bar span { opacity: 1; }
        .search.done { padding-right: 56px; transition: padding .4s ease; }
        .search.done .bar .icon { transform: rotateY(180deg); opacity: 0; }
        .search.done .close { opacity: 1; visibility: visible; transform: translate(0, 0); transition: transform .4s ease .5s, opacity .4s ease .5s, visibility .4s ease .5s; }
        .search.done .close:hover { background: var(--accent-primary-hover); }
        .search.done .close:hover:before, .search.done .close:hover:after { background: #fff; }
        .search.reset .bar:before { opacity: 0; transition: opacity 0s ease .4s; }
        .search.reset .bar .icon { transform: rotateY(0deg); transition: transform .4s ease 0s; }
        .header-left-cluster { display: flex; align-items: center; gap: 1.5rem; }
        .sidebar-toggle { font-size: 20px; color: var(--text-secondary); cursor: pointer; transition: all var(--transition-speed) ease; padding: 8px; border-radius: 8px; }
        .sidebar-toggle:hover { color: var(--accent-primary); background-color: var(--accent-primary-light); }
        .sidebar.collapsed { width: 88px; min-width: 88px; padding-left: 0; padding-right: 0; }
        .sidebar.collapsed .user-switch-wrapper, .sidebar.collapsed .nav-links li a, .sidebar.collapsed .theme-switcher-container { justify-content: center; }
        .sidebar.collapsed .user-switch-wrapper { padding-left: 15px; padding-right: 15px; }
        .sidebar.collapsed .logo-details, .sidebar.collapsed .user-switch-arrow, .sidebar.collapsed .nav-links li a > span, .sidebar.collapsed .has-submenu .dropdown-toggle > span, .sidebar.collapsed .menu-title, .sidebar.collapsed .dropdown-arrow, .sidebar.collapsed .user-details, .sidebar.collapsed .theme-switcher-container > span { opacity: 0; visibility: hidden; width: 0; transition: opacity 0.2s ease, visibility 0.2s ease, width 0.2s ease; white-space: nowrap; }
        .sidebar.collapsed .nav-links li a i { margin-right: 0; }
        .sidebar.collapsed .nav-links li.active > a:not(.dropdown-toggle)::before { left: 0; border-radius: 0; height: 100%; opacity: 0.5; }
        .sidebar.collapsed .has-submenu.active .submenu, .sidebar.collapsed .has-submenu .submenu { display: none; }
        .sidebar.collapsed .has-submenu .dropdown-toggle { pointer-events: none; }
        .pages { padding: 2.5rem; }
        .page { display: none; animation: fadeIn var(--page-transition-duration) ease-out forwards; }
        .page.active { display: block; }
        .page.hiding { animation: fadeOut var(--page-transition-duration) ease-in forwards; }
        
        /* --- STYLES FROM markattendence.html --- */
        /* Body font is already set by index.html, but we keep background */
        .main-content { /* Target main-content instead of body */
            background-color: #F7F8FA;
        }
        #lecture-hall {
            height: 250px;
            border-radius: 0.5rem;
            background-color: #fff;
            border: 1px solid #e5e7eb;
            position: relative;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Adjusted for static teacher and desks */
            align-items: center;
        }
        .desk-row { display: flex; justify-content: center; gap: 2rem; width: 100%; margin-bottom: 0.5rem; }
        .desk { width: 30px; height: 20px; background-color: #e5e7eb; border-radius: 4px; position: relative; }
        .student-dot {
            position: absolute;
            width: 8px; /* Slightly larger dot */
            height: 8px; /* Slightly larger dot */
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: background-color 0.3s ease;
        }
        .student-dot.present { background-color: #22c55e; } /* green-500 */
        .student-dot.absent { background-color: #ef4444; } /* red-500 */
        .student-dot.late { background-color: #f59e0b; } /* amber-500 */

        #teacher-marker {
            width: 24px; height: 24px; border-radius: 9999px; position: absolute;
            background-color: #ef4444; /* Red color for teacher */
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.7);
            top: 15%; /* Teacher sits at one place */
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        /* GPS Signal Animation */
        .gps-signal::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            border: 2px solid #ef4444; /* Red signal */
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(1);
            opacity: 0;
            animation: pulse-gps 3s infinite; /* Slowed down animation */
        }
        @keyframes pulse-gps {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0.75; }
            100% { transform: translate(-50%, -50%) scale(10); opacity: 0; } /* Signal covers full class */
        }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #a3a3a3; }
        
        .status-btn-group input[type="radio"] { display: none; }
        .status-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 4px 8px; /* Reduced horizontal padding */
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            background-color: #f3f4f6;
            color: #4b5563;
        }
        .status-btn-group input[type="radio"]:checked + .status-btn.present { background-color: #d1fae5; color: #065f46; }
        .status-btn-group input[type="radio"]:checked + .status-btn.absent { background-color: #fee2e2; color: #991b1b; }
        .status-btn-group input[type="radio"]:checked + .status-btn.late { background-color: #fef3c7; color: #92400e; }

        #student-details-modal { transition: opacity 0.3s ease-in-out; }

        /* Dropdown styles */
        .filter-card { transition: all 0.3s ease; }
        .filter-card.active {
            box-shadow: 0 0 0 2px #4A72FF;
            background-color: #eff6ff;
        }
        .chevron-icon { transition: transform 0.3s ease; }
        .filter-card.active .chevron-icon { transform: rotate(180deg); }
        .filter-dropdown {
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-height 0.3s ease-out, opacity 0.2s ease-out;
        }
        .filter-dropdown.open {
            max-height: 200px; /* Adjust as needed */
            opacity: 1;
        }
        
        /* Student Table Improvements */
        #student-list tr:nth-child(even) { background-color: #f9fafb; } /* gray-50 */
        #student-list tr:hover { background-color: #f3f4f6; } /* gray-100 */

        /* Toast Notification Style */
        #toast-notification.show {
            opacity: 1;
            transform: translate(-50%, 0);
        }
        #toast-notification.success { background-color: #22c55e; } /* green-500 */
        #toast-notification.error { background-color: #ef4444; } /* red-500 */
    </style>
</head>
<body>

    <div class="app-container">
        <!-- Sidebar from index.html -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="user-switch-wrapper">
                    <svg class="logo-icon" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path></svg>
                    <div class="logo-details">
                        <span class="logo-name">Alex Johnson</span>
                        <span class="logo-subtext">student</span>
                    </div>
                    <i class="fa-solid fa-chevron-down user-switch-arrow"></i>
                </div>
                <div class="user-switcher-menu">
                    <div class="switcher-item" data-name="Alex Johnson" data-role="student"> <i class="fa-solid fa-user-graduate"></i> <span>Student</span> </div>
                    <div class="switcher-item" data-name="Prof. Anderson" data-role="teacher"> <i class="fa-solid fa-user-tie"></i> <span>Teacher</span> </div>
                </div>
            </div>

            <div class="sidebar-menu">
                <div class="menu-section">
                    <span class="menu-title">Menu</span>
                    <ul class="nav-links">
                        <li><a href="#home" class="nav-link"><i class="fa-solid fa-table-cells-large"></i> <span>Dashboard</span></a></li>
                        <!-- ATTENDANCE DROPDOWN -->
                        <li class="has-submenu active"> <!-- Made this active -->
                            <a class="nav-link dropdown-toggle">
                                <span><i class="fa-solid fa-user-check"></i> <span>Attendance</span></span>
                                <i class="fa-solid fa-chevron-down dropdown-arrow"></i>
                            </a>
                            <ul class="submenu">
                                <li><a href="#"><span>Mark Attendance</span></a></li>
                                <li><a href="#"><span>Attendance Log</span></a></li>
                            </ul>
                        </li>
                        <li><a href="#timetable" class="nav-link"><i class="fa-solid fa-calendar-days"></i> <span>Timetable</span></a></li>
                        <li class="has-submenu">
                            <a class="nav-link dropdown-toggle">
                                <span><i class="fa-solid fa-comments"></i> <span>Group Chats</span></span>
                                <i class="fa-solid fa-chevron-down dropdown-arrow"></i>
                            </a>
                            <ul class="submenu">
                                <li><a href="#"><img src="https://i.pravatar.cc/150?u=group1" alt="Logo"><span>Project Phoenix</span><span class="notification-badge">3</span></a></li>
                                <li><a href="#"><img src="https://i.pravatar.cc/150?u=group2" alt="Logo"><span>Calculus Study Group</span><span class="notification-badge">1</span></a></li>
                                <li><a href="#"><img src="https://i.pravatar.cc/150?u=group3" alt="Logo"><span>CS Dept. Announcements</span></a></li>
                                <li><a href="#"><img src="https://i.pravatar.cc/150?u=group4" alt="Logo"><span>Hackathon Team</span><span class="notification-badge">7</span></a></li>
                                <li><a href="#"><img src="https://i.pravatar.cc/150?u=group5" alt="Logo"><span>Senior Design Project</span></a></li>
                            </ul>
                        </li>
                        <li><a href="#exams" class="nav-link"><i class="fa-solid fa-file-pen"></i> <span>Exams / Results</span></a></li>
                    </ul>
                </div>
                <div class="menu-section">
                    <span class="menu-title">Insights</span>
                    <ul class="nav-links">
                        <li><a href="#ai-assistant" class="nav-link"><i class="fa-solid fa-robot"></i> <span>AI Assistant</span></a></li>
                        <li><a href="#notes" class="nav-link"><i class="fa-solid fa-note-sticky"></i> <span>Notes</span></a></li>
                        <li><a href="#assignments" class="nav-link"><i class="fa-solid fa-list-check"></i> <span>Assignments</span></a></li>
                        <li><a href="#help" class="nav-link"><i class="fa-solid fa-circle-question"></i> <span>Help</span></a></li>
                        <li><a href="#settings" class="nav-link"><i class="fa-solid fa-cog"></i> <span>Settings</span></a></li>
                    </ul>
                </div>
            </div>

            <div class="sidebar-footer">
                <div class="theme-switcher-container">
                    <span>Dark/Light</span>
                    <div class="theme-switch">
                        <div class="switch-thumb"></div>
                        <i class="fa-solid fa-moon"></i>
                        <i class="fa-solid fa-sun"></i>
                    </div>
                </div>
                <div class="user-profile">
                    <img src="https://i.pravatar.cc/150?u=a042581f4e29026704d" alt="User Avatar">
                    <div class="user-details">
                        <span class="user-name">Alex Johnson</span>
                        <span class="user-email">alex.j@school.edu</span>
                    </div>
                </div>
            </div>
        </nav>
        
        <!-- Main content area -->
        <main class="main-content">
            <!-- Header from index.html -->
            <header>
                <div class="header-left-cluster">
                    <div class="sidebar-toggle">
                        <i class="fa-solid fa-bars"></i>
                    </div>
                    <div class="search">
                        <div class="bar"> <div class="icon"><i></i></div> </div>
                        <form><input type="text" placeholder="Search...."></form>
                        <div class="close"></div>
                        <ul>
                            <li><a href="#"><h5>Calculus II Notes</h5><p>Your notes from the last lecture.</p></a></li>
                            <li><a href="#"><h5>Hackathon Announcement</h5><p>Latest update from the CS Department.</p></a></li>
                        </ul>
                    </div>
                </div>
                <div class="header-actions">
                    <div class="profile">
                        <img src="https://i.pravatar.cc/150?u=a042581f4e29026704d" alt="Profile Picture">
                        <span>Alex Johnson</span>
                    </div>
                </div>
            </header>
            
            <!-- Content from markattendence.html (wrapper div removed) -->
            <main class="flex-1 p-6 overflow-y-auto custom-scrollbar text-gray-800">
                <h2 class="text-2xl font-semibold mb-4">Attendance</h2>
                
                <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
                    <div class="xl-col-span-1 bg-portal-gray p-4 rounded-lg">
                        <div class="bg-white p-4 rounded-lg border border-gray-200">
                            <h3 class="font-semibold mb-3">Lecture Hall View</h3>
                            <div id="lecture-hall" class="w-full shadow-inner overflow-hidden">
                                <div class="w-2/3 h-8 bg-gray-200 mx-auto rounded-md flex items-center justify-center text-sm font-semibold text-gray-600">Lecturer's Desk</div>
                                
                                <div id="teacher-marker" class="gps-signal" title="Teacher GPS"></div>

                                <div class="flex-grow space-y-6 pt-6" id="lecture-hall-desks">
                                    </div>
                            </div>
                             <div class="mt-3 flex justify-center items-center space-x-4 text-xs text-gray-600">
                                <span class="flex items-center"><span class="w-2.5 h-2.5 rounded-full bg-red-500 mr-1.5"></span>Teacher</span>
                                <span class="flex items-center"><span class="w-2.5 h-2.5 rounded-full bg-green-500 mr-1.5"></span>Present</span>
                                <span class="flex items-center"><span class="w-2.5 h-2.5 rounded-full bg-red-500 mr-1.5"></span>Absent</span>
                                <span class="flex items-center"><span class="w-2.5 h-2.5 rounded-full bg-amber-500 mr-1.5"></span>Late</span>
                            </div>
                        </div>
                        
                        <div class="space-y-3 mt-6" id="filter-container">
                            <div class="filter-group">
                                <div class="filter-card bg-white p-3 rounded-lg shadow-sm border border-gray-200 flex items-center justify-between cursor-pointer hover:shadow-md">
                                    <div class="flex items-center">
                                        <div class="bg-blue-100 p-2 rounded-md mr-3">
                                            <i data-lucide="book-open" class="w-5 h-5 text-portal-blue"></i>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500 font-medium">Course</p>
                                            <p class="font-semibold text-sm" data-value="Diploma of Accounting (FNS50217)">Diploma of Accounting (FNS50217)</p>
                                        </div>
                                    </div>
                                    <i data-lucide="chevron-down" class="chevron-icon w-5 h-5 text-gray-400"></i>
                                </div>
                                <div class="filter-dropdown bg-white rounded-lg shadow-md mt-1 border border-gray-200">
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center">Diploma of Accounting (FNS50217)</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center">Bachelor of Science</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center">Master of Business Administration</a>
                                </div>
                            </div>

                             <div class="filter-group">
                                <div class="filter-card bg-white p-3 rounded-lg shadow-sm border border-gray-200 flex items-center justify-between cursor-pointer hover:shadow-md">
                                    <div>
                                        <p class="text-xs text-gray-500 font-medium">Subject</p>
                                        <p class="font-semibold text-sm" data-value="Basics of User Research">Basics of User Research</p>
                                    </div>
                                    <i data-lucide="chevron-down" class="chevron-icon w-5 h-5 text-gray-400"></i>
                                </div>
                                 <div class="filter-dropdown bg-white rounded-lg shadow-md mt-1 border border-gray-200">
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center">Basics of User Research</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center">Advanced Calculus</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center">Corporate Finance</a>
                                </div>
                            </div>
                            
                            <div class="filter-group">
                                <div class="filter-card bg-white p-3 rounded-lg shadow-sm border border-gray-200 flex items-center justify-between cursor-pointer hover:shadow-md">
                                    <div>
                                        <p class="text-xs text-gray-500 font-medium">Semester</p>
                                        <p class="font-semibold text-sm" data-value="Winter Sem - Term 1">Winter Sem - Term 1</p>
                                    </div>
                                    <i data-lucide="chevron-down" class="chevron-icon w-5 h-5 text-gray-400"></i>
                                </div>
                                <div class="filter-dropdown bg-white rounded-lg shadow-md mt-1 border border-gray-200">
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center">Winter Sem - Term 1</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center">Fall Sem - Term 2</a>
                                </div>
                            </div>
                            
                            <div class="filter-group">
                                <div class="filter-card bg-white p-3 rounded-lg shadow-sm border border-gray-200 flex items-center justify-between cursor-pointer hover:shadow-md">
                                    <div>
                                        <p class="text-xs text-gray-500 font-medium">Group</p>
                                        <p class="font-semibold text-sm" data-value="Batch B">Batch B</p>
                                    </div>
                                    <i data-lucide="chevron-down" class="chevron-icon w-5 h-5 text-gray-400"></i>
                                </div>
                                <div class="filter-dropdown bg-white rounded-lg shadow-md mt-1 border border-gray-200">
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center">Batch A</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center">Batch B</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center">Batch C</a>
                                </div>
                            </div>
                            <button id="clear-filters-btn" class="w-full mt-2 text-sm text-portal-blue font-semibold hover:underline focus:outline-none">Clear filters</button>
                        </div>
                    </div>

                    <div class="xl:col-span-2 bg-white p-6 rounded-lg border border-gray-200">
                        <div class="flex flex-wrap justify-between items-center pb-4 mb-4 gap-4">
                            <div class="flex items-center gap-4">
                                <a href="#" class="text-gray-600 hover:text-gray-900"><i data-lucide="arrow-left" class="w-6 h-6"></i></a>
                                <h3 class="text-lg font-semibold">Mark Attendance</h3>
                            </div>
                            <div class="flex items-center gap-4 text-sm">
                               <span class="text-gray-500">Course: Diploma of Accounting (FNS50217)</span>
                               <button class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-md font-semibold text-sm flex items-center gap-2 hover:bg-gray-50"><i data-lucide="download" class="w-4 h-4"></i>Download Esl</button>
                            </div>
                        </div>
                        
                        <div class="border rounded-lg p-4 flex flex-wrap justify-between items-center gap-4">
                            <div>
                                <p class="font-semibold">Subject: Basics of User Research (BB5012)</p>
                                <p class="text-sm text-gray-500">Class C4, Batch B</p>
                            </div>
                             <div>
                                <p class="font-semibold">Time- 10:00 AM To 10:45 AM</p>
                                <p class="text-sm text-gray-500">Week 3 - Tuesday - 17 Jan 2020</p>
                            </div>
                            <div class="flex items-center gap-4">
                                <span class="inline-block bg-yellow-100 text-yellow-800 text-xs font-semibold px-2.5 py-1 rounded-full align-middle">Pending</span>
                                <div id="location-status-container"></div>
                                <button id="save-attendance-btn" class="bg-portal-blue text-white px-6 py-2 rounded-md font-semibold text-sm hover:bg-blue-600">Save Attendance</button>
                            </div>
                        </div>

                        <div class="overflow-x-auto custom-scrollbar mt-4">
                            <table class="w-full text-left text-sm">
                                <thead>
                                    <tr class="border-b-2 border-gray-200">
                                        <th class="p-2 font-semibold text-gray-600">Student ID</th>
                                        <th class="p-2 font-semibold text-gray-600">Student Name</th>
                                        <th class="p-2 font-semibold text-gray-600 text-center">Status</th>
                                        <th class="p-2 font-semibold text-gray-600">Total Hours</th>
                                        <th class="p-2 font-semibold text-gray-600">Status</th>
                                        <th class="p-2 font-semibold text-gray-600"></th>
                                    </tr>
                                </thead>
                                <tbody id="student-list">
                                    </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Modal and Toast from markattendence.html -->
            <div id="student-details-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0 z-50"> <!-- Added z-50 -->
                <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl transform scale-95 transition-transform duration-300">
                     <div class="flex justify-between items-center p-4 border-b">
                        <h3 class="text-lg font-semibold">Student Name: <span id="modal-student-name"></span></h3>
                        <button id="close-modal-btn" class="text-gray-500 hover:text-gray-800"><i data-lucide="x" class="w-6 h-6"></i></button>
                    </div>
                    <div class="p-6">
                        <div class="flex border-b">
                            <button class="py-2 px-4 text-portal-blue border-b-2 border-portal-blue font-semibold">Results</button>
                            <button class="py-2 px-4 text-gray-500 font-semibold">Attendance</button>
                        </div>
                         <div class="mt-4">
                            <p class="text-sm text-gray-500">ID: <span id="modal-student-id"></span> | Total Hours: <span id="modal-student-hours"></span></p>
                            <table class="w-full text-left text-sm mt-2">
                                <thead>
                                    <tr class="bg-gray-50">
                                        <th class="p-2 font-semibold">Assessment</th>
                                        <th class="p-2 font-semibold">Due Date</th>
                                        <th class="p-2 font-semibold">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b"><td class="p-2">Unit 1 - Manage meetings (BBS012)</td><td class="p-2 text-gray-600">01/01/2021 - 06/07/2021</td><td></td></tr>
                                    <tr class="border-b"><td class="p-2 pl-6">Assessment 1 - Presentation on Meeting</td><td class="p-2 text-gray-600">25/01/2021</td><td class="p-2 font-medium text-green-600">Satisfactory</td></tr>
                                    <tr class="border-b"><td class="p-2 pl-6">Assessment 2 - OMR Test</td><td class="p-2 text-gray-600">25/01/2021</td><td class="p-2 font-medium text-red-600">Not Yet Satisfactory</td></tr>
                                </tbody>
                            </table>
                         </div>
                    </div>
                </div>
            </div>
            
            <div id="toast-notification" class="fixed bottom-5 left-1/2 -translate-x-1/2 px-6 py-3 text-white rounded-lg shadow-lg opacity-0 translate-y-10 transition-all duration-300 z-50"> <!-- Added z-50 -->
                <p id="toast-message"></p>
            </div>
            
        </main>
    </div>
    
    <!-- Script from index.html -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // Search Bar JS (Unchanged)
        $('.search').each(function() {
            var self = $(this); var form = self.children('form'); var input = form.children('input');
            var span = $('<span />').appendTo(form); var bar = self.children('.bar'); var close = self.children('.close');
            var list = self.children('ul'); bar.on('click', function(e) { if (!self.hasClass('open') && !self.hasClass('prepare')) { e.stopPropagation(); self.addClass('open'); input.focus(); } });
            $(document).on('click', function(e) { if (self.hasClass('open') && !self.hasClass('prepare') && !self.is(e.target) && self.has(e.target).length === 0) { self.removeClass('open'); } });
            form.submit(function(e) { e.preventDefault(); if(!self.hasClass('prepare') && input.val().length > 0) { input.css('color', 'transparent'); input.blur(); $('<span />').text(input.val()).appendTo(bar); self.addClass('prepare submit'); setTimeout(function() { self.removeClass('submit'); }, 200); setTimeout(function() { self.addClass('animate'); bar.animate({ width: (self.outerWidth() - 32) }, 800, function() { var searchW = ((list.outerWidth() + 32) > (72 + bar.outerWidth())) ? (list.outerWidth() + 32) : 72 + bar.outerWidth(); self.animate({ width: searchW }, 400); setTimeout(function() { self.animate({ height: self.outerHeight() + list.outerHeight() }, 500, function() { list.addClass('show'); }); }, 200); }); setTimeout(function() { self.addClass('done'); }, 800); }, 1250); } });
            close.on('click', function(e) { self.removeClass('done'); setTimeout(function() { list.removeClass('show'); bar.animate({ width: 32 }, 1000, function() { self.addClass('reset'); bar.children('span').remove(); setTimeout(function() { self.removeClass('animate reset prepare'); input.css('color', ''); setTimeout(function() { input.val(''); bar.removeAttr('style'); }, 200); }, 400); }); setTimeout(function() { self.animate({ height: 62 }, 400, function() { self.removeClass('open'); setTimeout(function() { self.removeAttr('style'); }, 450); }); }, 200); }, 500); });
        });

        // --- CORRECTED & COMPLETE PAGE/LINK LOGIC ---
        const allNavLinks = document.querySelectorAll('.nav-link:not(.dropdown-toggle)');
        const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
        
        function handlePageSwitch(targetId) {
            // This function is for single-page apps. Since we are creating
            // separate files, we'll just handle the active state.
            // In a real multi-page app, you'd check window.location.pathname
            
            document.querySelectorAll('.nav-links li').forEach(li => {
                li.classList.remove('active');
            });
            
            // Find the link that matches the current page (e.g., 'Attendance')
            // This is a simple example; a real app would be more robust
            const activeLink = document.querySelector('.nav-link span:last-child'); // Failsafe
            if (activeLink) {
                 // Trying to find 'Attendance' link
                document.querySelectorAll('.nav-link').forEach(link => {
                    const linkText = link.querySelector('span:last-child');
                    if(linkText && (linkText.textContent === 'Attendance' || linkText.textContent === 'Mark Attendance')) {
                         link.closest('li').classList.add('active');
                    }
                });
            }
        }
        
        // Remove page switching logic, just set active state
        allNavLinks.forEach(link => {
            link.addEventListener('click', e => {
                // In a real multi-page app, this would be a regular link click
                // e.preventDefault(); 
                // For this demo, we prevent default to stop page reload errors
                e.preventDefault(); 
                document.querySelectorAll('.has-submenu.active').forEach(submenu => submenu.classList.remove('active'));
                
                document.querySelectorAll('.nav-links li').forEach(li => {
                    if (!li.classList.contains('has-submenu')) {
                        li.classList.remove('active');
                    }
                });
                link.closest('li').classList.add('active');
            });
        });

        // --- UPDATED DROPDOWN LOGIC TO HANDLE ALL SUBMENUS ---
        dropdownToggles.forEach(toggle => {
            toggle.addEventListener('click', (e) => {
                e.preventDefault();
                toggle.closest('.has-submenu').classList.toggle('active');
            });
        });
        
        // Manually set active state for this page
        handlePageSwitch(); // Will find and activate 'Attendance'

        // User Switcher Logic (Unchanged)
        const userSwitchWrapper = document.querySelector('.user-switch-wrapper');
        const userSwitchMenu = document.querySelector('.user-switcher-menu');
        const userSwitchArrow = document.querySelector('.user-switch-arrow');
        const switcherItems = document.querySelectorAll('.switcher-item');
        const userNameDisplay = document.querySelector('.logo-details .logo-name');
        const userRoleDisplay = document.querySelector('.logo-details .logo-subtext');
        // const welcomeHeader = document.querySelector('.page-header h2'); // This element doesn't exist here
        userSwitchWrapper.addEventListener('click', () => { userSwitchMenu.classList.toggle('active'); userSwitchArrow.classList.toggle('active'); });
        switcherItems.forEach(item => { item.addEventListener('click', () => { const name = item.getAttribute('data-name'); const role = item.getAttribute('data-role'); userNameDisplay.textContent = name; userRoleDisplay.textContent = role; /* welcomeHeader.textContent = `Welcome back, ${name.split(' ')[0]}! `; */ userSwitchMenu.classList.remove('active'); userSwitchArrow.classList.remove('active'); }); });

        // Theme Switcher Logic (Unchanged)
        const themeSwitch = document.querySelector('.theme-switch');
        const applyTheme = (theme) => { document.documentElement.setAttribute('data-theme', theme); localStorage.setItem('theme', theme); };
        themeSwitch.addEventListener('click', () => { const currentTheme = document.documentElement.getAttribute('data-theme'); const newTheme = currentTheme === 'light' ? 'dark' : 'light'; applyTheme(newTheme); });
        const savedTheme = localStorage.getItem('theme') || 'light';
        applyTheme(savedTheme);
        
        // --- NEW: SIDEBAR TOGGLE LOGIC ---
        const sidebarToggle = document.querySelector('.sidebar-toggle');
        const sidebar = document.querySelector('.sidebar');
        
        if (sidebarToggle && sidebar) {
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');
            });
        }
    });
    </script>
    
    <!-- Script from markattendence.html -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            
            const studentData = [
                { id: 'BSB1011', name: 'Jeremy Schmidt', hours: 12, status: 'present' }, 
                { id: 'BSB1012', name: 'Carla Monteiro', hours: 11, status: 'absent' },
                { id: 'BSB1013', name: 'Lungelo Ngcobo', hours: 12, status: 'present' }, 
                { id: 'BSB1014', name: 'Sampson Tutton', hours: 12, status: 'late' },
                { id: 'BSB1015', name: 'Abbie Wilson', hours: 12, status: 'present' }, 
                { id: 'BSB1016', name: 'Sukhbirpal Dhalan', hours: 10, status: 'absent' },
                { id: 'BSB1017', name: 'Joana Leite', hours: 12, status: 'present' }, 
                { id: 'BSB1018', name: 'Shen Zhi', hours: 12, status: 'present' },
                { id: 'BSB1019', name: 'Tatiana Gagetman', hours: 11, status: 'late' }, 
                { id: 'BSB1020', name: 'Brbara Coilla', hours: 12, status: 'present' },
            ];

            const studentList = document.getElementById('student-list');
            const lectureHallDesks = document.getElementById('lecture-hall-desks');

            function renderStudents() {
                if (!studentList || !lectureHallDesks) return; // Add check
                studentList.innerHTML = '';
                lectureHallDesks.innerHTML = '';
                
                let deskRow = document.createElement('div');
                deskRow.className = 'desk-row';

                studentData.forEach((student, index) => {
                    // Create Table Row
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="p-2 text-gray-600">${student.id}</td>
                        <td class="p-2 font-semibold">${student.name}</td>
                        <td class="p-2">
                            <div class="flex items-center justify-center space-x-1 status-btn-group">
                                <input type="radio" id="present-${index}" name="status-${index}" value="present" ${student.status === 'present' ? 'checked' : ''} data-id="${student.id}">
                                <label for="present-${index}" class="status-btn present"><i data-lucide="check" class="w-4 h-4"></i>Present</label>
                                
                                <input type="radio" id="absent-${index}" name="status-${index}" value="absent" ${student.status === 'absent' ? 'checked' : ''} data-id="${student.id}">
                                <label for="absent-${index}" class="status-btn absent"><i data-lucide="x" class="w-4 h-4"></i>Absent</label>
                                
                                <input type="radio" id="late-${index}" name="status-${index}" value="late" ${student.status === 'late' ? 'checked' : ''} data-id="${student.id}">
                                <label for="late-${index}" class="status-btn late"><i data-lucide="clock" class="w-4 h-4"></i>Late</label>
                            </div>
                        </td>
                        <td class="p-2 text-gray-600">${student.hours} Hours</td>
                        <td class="p-2 text-green-600 font-medium">Enrolled</td>
                        <td class="p-2 text-right">
                            <button class="text-gray-500 hover:text-portal-blue view-details-btn" data-index="${index}"><i data-lucide="eye" class="w-5 h-5"></i></button>
                        </td>
                    `;
                    studentList.appendChild(row);

                    // Create Desks and Dots in Lecture Hall
                    if (index > 0 && index % 3 === 0) {
                        lectureHallDesks.appendChild(deskRow);
                        deskRow = document.createElement('div');
                        deskRow.className = 'desk-row';
                    }
                    const desk = document.createElement('div');
                    desk.className = 'desk';
                    const dot = document.createElement('div');
                    dot.className = `student-dot ${student.status}`;
                    dot.dataset.studentId = student.id;
                    desk.appendChild(dot);
                    deskRow.appendChild(desk);
                });
                lectureHallDesks.appendChild(deskRow); // Append the last row

                lucide.createIcons();
            }
            renderStudents();

            // Handle Status Changes
            studentList.addEventListener('change', (e) => {
                if(e.target.type === 'radio') {
                    const studentId = e.target.dataset.id;
                    const newStatus = e.target.value;
                    const studentDot = lectureHallDesks.querySelector(`.student-dot[data-student-id="${studentId}"]`);
                    if(studentDot) {
                        studentDot.className = `student-dot ${newStatus}`;
                    }
                }
            });
            
            // Dropdown functionality
            const filterContainer = document.getElementById('filter-container');
            const checkmarkIcon = `<span class="w-4 h-4 mr-2 text-portal-blue"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check"><polyline points="20 6 9 17 4 12"></polyline></svg></span>`;

            if(filterContainer) {
                filterContainer.addEventListener('click', function(e) {
                    const card = e.target.closest('.filter-card');
                    if (card) {
                        const parentGroup = card.closest('.filter-group');
                        // Toggle current dropdown
                        parentGroup.classList.toggle('open');
                        document.querySelectorAll('.filter-group').forEach(group => {
                            if (group !== parentGroup) {
                                group.querySelector('.filter-card').classList.remove('active');
                                group.querySelector('.filter-dropdown').classList.remove('open');
                            }
                        });
                        parentGroup.querySelector('.filter-card').classList.toggle('active');
                        parentGroup.querySelector('.filter-dropdown').classList.toggle('open');
                    }

                    const link = e.target.closest('a');
                    if (link) {
                        e.preventDefault();
                        const parentGroup = link.closest('.filter-group');
                        const valueDisplay = parentGroup.querySelector('[data-value]');
                        const dropdown = parentGroup.querySelector('.filter-dropdown');
                        
                        // Update value and add checkmark
                        valueDisplay.textContent = link.textContent;
                        dropdown.querySelectorAll('a').forEach(a => {
                            if(a.firstChild && a.firstChild.tagName === 'SPAN') a.firstChild.remove();
                        }); // Clear old checkmarks
                        link.insertAdjacentHTML('afterbegin', checkmarkIcon);

                        // Close dropdown
                        parentGroup.querySelector('.filter-card').classList.remove('active');
                        dropdown.classList.remove('open');
                    }
                });
            }

             // Clear Filters
            const clearFiltersBtn = document.getElementById('clear-filters-btn');
            if (clearFiltersBtn) {
                clearFiltersBtn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-group').forEach(group => {
                        const valueDisplay = group.querySelector('[data-value]');
                        valueDisplay.textContent = valueDisplay.dataset.value;
                        group.querySelectorAll('a').forEach(a => {
                            if(a.firstChild && a.firstChild.tagName === 'SPAN') a.firstChild.remove();
                        });
                    });
                });
            }


            // Location Status Logic
            let currentStatus = '';
            const locationStatusContainer = document.getElementById('location-status-container');
            const statuses = [
                { text: 'In Class', classes: 'bg-green-100 text-green-800' },
                { text: 'Outside Class', classes: 'bg-orange-100 text-orange-800' }
            ];

            function updateLocationStatus() {
                if(!locationStatusContainer) return;
                const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                currentStatus = randomStatus.text;
                locationStatusContainer.innerHTML = `<div class="inline-block px-2.5 py-1 rounded-md text-xs font-semibold ${randomStatus.classes}">${randomStatus.text}</div>`;
            }

            setInterval(updateLocationStatus, 4000);
            updateLocationStatus();

            // --- Student Details Modal Logic ---
            const studentModal = document.getElementById('student-details-modal');
            const modalStudentName = document.getElementById('modal-student-name');
            const modalStudentId = document.getElementById('modal-student-id');
            const modalStudentHours = document.getElementById('modal-student-hours');
            const closeStudentModalBtn = document.getElementById('close-modal-btn');

            function openStudentModal(student) {
                modalStudentName.textContent = student.name;
                modalStudentId.textContent = student.id;
                modalStudentHours.textContent = `${student.hours} Hours`;
                studentModal.classList.remove('hidden');
                setTimeout(() => {
                    studentModal.classList.remove('opacity-0');
                    studentModal.querySelector('div').classList.remove('scale-95');
                }, 10);
            }

            function closeStudentModal() {
                studentModal.classList.add('opacity-0');
                studentModal.querySelector('div').classList.add('scale-95');
                setTimeout(() => studentModal.classList.add('hidden'), 300);
            }

            studentList.addEventListener('click', function(e) {
                const viewBtn = e.target.closest('.view-details-btn');
                if (viewBtn) {
                    openStudentModal(studentData[viewBtn.dataset.index]);
                }
            });

            closeStudentModalBtn.addEventListener('click', closeStudentModal);
            studentModal.addEventListener('click', (e) => e.target === studentModal && closeStudentModal());

            // --- Toast Notification Logic ---
            const saveAttendanceBtn = document.getElementById('save-attendance-btn');
            const toast = document.getElementById('toast-notification');
            const toastMessage = document.getElementById('toast-message');
            let toastTimeout;

            function showToast(message, type) {
                if(!toast || !toastMessage) return;
                clearTimeout(toastTimeout);
                toast.className = 'fixed bottom-5 left-1/2 -translate-x-1/2 px-6 py-3 text-white rounded-lg shadow-lg opacity-0 translate-y-10 transition-all duration-300 z-50'; // Reset classes
                if (type) toast.classList.add(type);

                toastMessage.textContent = message;
                toast.classList.add('show');
                toastTimeout = setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000); // Hide after 3 seconds
            }

            if(saveAttendanceBtn) {
                saveAttendanceBtn.addEventListener('click', () => {
                    if (currentStatus === 'In Class') {
                        showToast('Attendance marked successfully!', 'success');
                    } else {
                        showToast('You are not in class. Attendance cannot be marked.', 'error');
                    }
                });
            }
        });
    </script>

</body>
</html>
